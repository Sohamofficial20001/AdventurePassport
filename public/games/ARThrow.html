<!-- <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Stationary Bin AR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        canvas.a-canvas {
            touch-action: none !important;
        }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">

    <div id="overlay"
        style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <button onclick="start()"
            style="padding:20px 40px; font-size:24px; border-radius:10px; border:none; background:#e67e22; color:white;">SET
            BIN & PLAY</button>
        <p style="margin-top:10px">Look straight ahead before clicking</p>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
        vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true">

        <a-entity id="world-root">

            <a-entity id="basket-center" position="0 -1.5 -7">
                <a-cylinder color="#e74c3c" height="1" radius="0.65" open-ended="true" side="double"></a-cylinder>
                <a-text value="Veggies" align="center" position="0 1.5 0" scale="2 2 2"></a-text>
            </a-entity>

            <a-entity id="basket-left" position="-2.5 -1.5 -7">
                <a-cylinder color="#3498db" height="1" radius="0.65" open-ended="true" side="double"></a-cylinder>
                <a-text value="Fruits" align="center" position="0 1.5 0" scale="2 2 2"></a-text>
            </a-entity>

            <a-entity id="basket-right" position="2.5 -1.5 -7">
                <a-cylinder color="#f1c40f" height="1" radius="0.65" open-ended="true" side="double"></a-cylinder>
                <a-text value="KuchAur" align="center" position="0 1.5 0" scale="2 2 2"></a-text>
            </a-entity>

        </a-entity>

        <a-entity id="camera-rig" position="0 1.6 0">
            <a-camera id="mainCam" look-controls="enabled: true; touchEnabled: false; magicWindowTrackingEnabled: true"
                wasd-controls-enabled="false">
                <a-entity cursor="fuse: false" position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                    material="color: #FFF; shader: flat">
                </a-entity>
            </a-camera>
        </a-entity>

    </a-scene>

    <div id="score-container"
        style="position:fixed; top:20px; left:20px; z-index:1001; pointer-events:none; font-family:sans-serif; text-shadow:2px 2px 4px #000;">
        <div style="color:#2ecc71; font-size:12px; font-weight:bold;">SCORE</div>
        <div id="score-val" style="color:white; font-size:32px; font-weight:bold;">0</div>
    </div>

    <div id="target-container"
        style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:1001; text-align:center; font-family:sans-serif; pointer-events:none;">
        <div style="color:#67e8f9; font-size:12px; font-weight:bold;">HOLDING</div>
        <div id="current-label-ui"
            style="color:white; font-size:28px; font-weight:bold; background:rgba(0,0,0,0.3); padding:5px 20px; border-radius:15px;">
            ---</div>
    </div>

    <div id="timer-container"
        style="position:fixed; top:20px; right:20px; z-index:1001; pointer-events:none; font-family:sans-serif; text-shadow:2px 2px 4px #000; text-align:right;">
        <div style="color:#e67e22; font-size:12px; font-weight:bold;">TIME</div>
        <div id="time-val" style="color:white; font-size:32px; font-weight:bold;">60</div>
    </div>

    <script>
        let score = 0;
        let timeLeft = 60;
        let canThrow = false;
        let gameActive = false;
        let timerInterval;
        let currentItem = null;

        const scene = document.querySelector('a-scene');
        const cam = document.querySelector('#mainCam');

        const gameConfig = [
            { label: "Apple", target: "basket-left" },
            { label: "Banana", target: "basket-left" },
            { label: "Carrot", target: "basket-center" },
            { label: "Broccoli", target: "basket-center" },
            { label: "Lollipop", target: "basket-right" },
            { label: "Chocolate", target: "basket-right" }
        ];

        function prepareNextItem() {
            currentItem = gameConfig[Math.floor(Math.random() * gameConfig.length)];
            document.getElementById('current-label-ui').innerText = currentItem.label.toUpperCase();
        }

        function start() {
            document.getElementById('overlay').style.display = 'none';
            score = 0;
            timeLeft = 60;
            gameActive = true;
            canThrow = true;

            document.getElementById('score-val').innerText = "0";
            document.getElementById('time-val').innerText = "60";

            prepareNextItem();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('time-val');
                timerEl.innerText = timeLeft;

                if (timeLeft <= 10) {
                    timerEl.style.color = "#ff3333";
                }

                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // ⭐⭐⭐ UPDATED — SEND RESULT TO REACT APP AND CLOSE TAB
        function endGame() {
            clearInterval(timerInterval);
            gameActive = false;
            canThrow = false;

            // ⭐ define win rule
            const didWin = score >= 30;

            // ⭐ notify opener (to React app)
            if (window.opener) {
                window.opener.postMessage({
                    type: "AR_GAME_RESULT",
                    // score: score,
                    win: didWin,
                    metadata: {
                        score: score,
                        minScoreToWin: 30,
                        timePlayed: 60,
                    }
                }, "*");
            }

            // ⭐ optionally show a small message
            // alert("Final Score: " + score);

            // ⭐ close AR tab automatically
            window.close();
        }

        // --- swipe logic remains unchanged ---
        let startX, startY;
        window.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        window.addEventListener('touchend', (e) => {
            if (!canThrow || !gameActive) return;

            let diffX = e.changedTouches[0].clientX - startX;
            let diffY = startY - e.changedTouches[0].clientY;

            if (diffY > 60) {
                canThrow = false;
                let horizontalTilt = diffX / window.innerWidth;
                throwBall(horizontalTilt);
                setTimeout(() => { if (gameActive) canThrow = true; }, 800);
            }
        });

        function throwBall(tilt) {
            const itemBeingThrown = currentItem;

            const wrapper = document.createElement('a-entity');
            const ball = document.createElement('a-sphere');

            ball.setAttribute('radius', '0.15');
            ball.setAttribute('color', 'white');
            wrapper.appendChild(ball);
            scene.appendChild(wrapper);

            prepareNextItem();

            const startPos = new THREE.Vector3();
            cam.object3D.getWorldPosition(startPos);

            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);

            const sideVector = new THREE.Vector3(1, 0, 0);
            sideVector.applyQuaternion(cam.object3D.quaternion);

            direction.addScaledVector(sideVector, tilt * 2);

            const distance = 8;
            const endPos = {
                x: startPos.x + direction.x * distance,
                y: -1.5,
                z: startPos.z + direction.z * distance
            };

            wrapper.setAttribute('animation', { property: 'position', to: `${endPos.x} ${endPos.y} ${endPos.z}`, dur: 1000 });

            setTimeout(() => {
                const buckets = ['basket-left', 'basket-center', 'basket-right'];

                buckets.forEach(id => {
                    const bucket = document.getElementById(id);
                    const bPos = bucket.object3D.position;

                    const dist = Math.sqrt(
                        Math.pow(endPos.x - bPos.x, 2) +
                        Math.pow(endPos.z - bPos.z, 2)
                    );

                    if (dist < 0.9) {
                        if (id === itemBeingThrown.target) {
                            score += 10;
                            updateScoreUI();
                        }
                    }
                });

                if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
            }, 1100);
        }

        function updateScoreUI() {
            document.getElementById('score-val').innerText = score;
        }
    </script>

</body>

</html> -->


<!-- 
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SAP Astrology: Fast Tap AR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        canvas.a-canvas { touch-action: none !important; }
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; color: white; text-align: center; padding: 20px;
        }

        .btn-start {
            padding: 20px 40px; font-size: 24px; border-radius: 12px;
            border: none; background: #e67e22; color: white; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px #d35400; transition: all 0.2s;
        }

        .btn-start:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }

        .ui-panel { position: fixed; z-index: 1001; pointer-events: none; text-shadow: 2px 2px 4px #000; }

        /* Full screen flash overlay for feedback */
        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; pointer-events: none; opacity: 0;
            transition: opacity 0.1s ease-in-out;
        }
    </style>
</head>

<body>

    <div id="flash-overlay"></div>

    <div id="overlay">
        <h1 style="color: #67e8f9; margin-bottom: 5px; letter-spacing: 2px;">SAP FAST TAP</h1>
        <p style="margin-bottom: 25px; opacity: 0.8; line-height: 1.5;">
            <b>Mission: Rapid Identification</b><br>
            Sort SAP Terms into the BLUE bucket.<br>
            Sort Dummy Terms into the RED bucket.
        </p>
        <button class="btn-start" onclick="start()">START CHALLENGE</button>
        <p style="margin-top: 20px; font-size: 13px; color: #aaa;">Point forward & flick up to toss!</p>
    </div>

    <div class="ui-panel" style="top: 20px; left: 20px;">
        <div style="color: #2ecc71; font-size: 12px; font-weight: bold; letter-spacing: 1px;">SCORE</div>
        <div id="score-val" style="color: white; font-size: 32px; font-weight: bold;">0</div>
    </div>

    <div class="ui-panel" style="top: 20px; left: 50%; transform: translateX(-50%); text-align: center;">
        <div style="color: #67e8f9; font-size: 10px; font-weight: bold; letter-spacing: 2px;">HOLDING</div>
        <div id="current-label-ui" style="color: white; font-size: 28px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 8px 25px; border-radius: 20px; border: 1px solid rgba(103, 232, 249, 0.3); min-width: 120px;">---</div>
    </div>

    <div class="ui-panel" style="top: 20px; right: 20px; text-align: right;">
        <div style="color: #e67e22; font-size: 12px; font-weight: bold; letter-spacing: 1px;">TIME</div>
        <div id="time-val" style="color: white; font-size: 32px; font-weight: bold;">15</div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;" vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true">
        
        <a-entity id="world-root">
            <a-entity id="basket-sap" position="-1.8 -1.5 -7">
                <a-cylinder color="#3498db" height="1.2" radius="0.75" open-ended="true" side="double"></a-cylinder>
                <a-text value="SAP TERM" align="center" position="0 1.5 0" scale="2.5 2.5 2.5" color="#3498db" bold="true"></a-text>
                <a-ring color="black" radius-inner="0.6" radius-outer="0.9" rotation="-90 0 0" position="0 -0.59 0" opacity="0.3"></a-ring>
            </a-entity>

            <a-entity id="basket-not-sap" position="1.8 -1.5 -7">
                <a-cylinder color="#e74c3c" height="1.2" radius="0.75" open-ended="true" side="double"></a-cylinder>
                <a-text value="NOT SAP" align="center" position="0 1.5 0" scale="2.5 2.5 2.5" color="#e74c3c" bold="true"></a-text>
                <a-ring color="black" radius-inner="0.6" radius-outer="0.9" rotation="-90 0 0" position="0 -0.59 0" opacity="0.3"></a-ring>
            </a-entity>
        </a-entity>

        <a-entity id="camera-rig" position="0 1.6 0">
            <a-camera id="mainCam" look-controls="enabled: true; touchEnabled: false; magicWindowTrackingEnabled: true" wasd-controls-enabled="false">
                <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015" material="color: #FFF; shader: flat"></a-entity>
            </a-camera>
        </a-entity>
    </a-scene>

    <script>
        // --- DATA CONFIGURATION ---
        const config = {
            timerSeconds: 15,
            winThreshold: 70,
            sapTerms: ["BAPI", "ABAP", "HANA", "FIORI", "OData", "Module", "Basis", "Cloud", "ERP", "NetWeaver", "CRM", "Ariba", "S/4HANA", "UI5", "FioriLaunchpad"],
            dummyTerms: ["Pizza", "Moon", "Forest", "Cloud-9", "C#", "Java", "React", "Swift", "Banana", "Football", "Sandwich", "Bicycle", "Guitar", "Mountain", "River"]
        };

        const gameItems = [
            ...config.sapTerms.map(t => ({ label: t, target: "basket-sap" })),
            ...config.dummyTerms.map(t => ({ label: t, target: "basket-not-sap" }))
        ];

        let score = 0;
        let timeLeft = config.timerSeconds;
        let canThrow = false;
        let gameActive = false;
        let currentItem = null;
        let timerInterval;

        const scene = document.querySelector('a-scene');
        const cam = document.querySelector('#mainCam');
        const flashOverlay = document.getElementById('flash-overlay');

        function prepareNextItem() {
            currentItem = gameItems[Math.floor(Math.random() * gameItems.length)];
            document.getElementById('current-label-ui').innerText = currentItem.label.toUpperCase();
        }

        function start() {
            document.getElementById('overlay').style.display = 'none';
            score = 0;
            timeLeft = config.timerSeconds;
            gameActive = true;
            canThrow = true;
            document.getElementById('score-val').innerText = "0";
            document.getElementById('time-val').innerText = timeLeft;
            document.getElementById('time-val').style.color = "white";
            prepareNextItem();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('time-val');
                timerEl.innerText = timeLeft;
                if (timeLeft <= 5) timerEl.style.color = "#ff3333";
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function endGame() {
            clearInterval(timerInterval);
            gameActive = false;
            canThrow = false;

            const didWin = score >= config.winThreshold;

            if (window.opener) {
                window.opener.postMessage({
                    type: "AR_GAME_RESULT",
                    win: didWin,
                    metadata: {
                        score: score,
                        minScoreToWin: config.winThreshold,
                        timePlayed: config.timerSeconds,
                        gameName: "SAP Fast Tap"
                    }
                }, "*");
            }

            alert(didWin ? "MISSION COMPLETE! Threshold Reached." : "TIME'S UP! Score: " + score);
            window.close();
        }

        // --- INTERACTION LOGIC ---
        let startX, startY;
        window.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        window.addEventListener('touchend', (e) => {
            if (!canThrow || !gameActive) return;
            let diffX = e.changedTouches[0].clientX - startX;
            let diffY = startY - e.changedTouches[0].clientY;

            if (diffY > 60) {
                canThrow = false;
                throwBall(diffX / window.innerWidth);
                setTimeout(() => { if (gameActive) canThrow = true; }, 400); 
            }
        });

        function throwBall(tilt) {
            const itemBeingThrown = currentItem;
            const wrapper = document.createElement('a-entity');
            const ball = document.createElement('a-sphere');

            ball.setAttribute('radius', '0.15');
            ball.setAttribute('color', 'white');
            ball.setAttribute('material', 'emissive: #ffffff; emissiveIntensity: 0.3');
            wrapper.appendChild(ball);
            scene.appendChild(wrapper);

            prepareNextItem(); // Update Top UI for next turn immediately

            const startPos = new THREE.Vector3();
            cam.object3D.getWorldPosition(startPos);
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);

            const sideVector = new THREE.Vector3(1, 0, 0);
            sideVector.applyQuaternion(cam.object3D.quaternion);
            direction.addScaledVector(sideVector, tilt * 2.5); 

            const endPos = {
                x: startPos.x + direction.x * 8,
                y: -1.5,
                z: startPos.z + direction.z * 8
            };

            wrapper.setAttribute('animation', { 
                property: 'position', 
                to: `${endPos.x} ${endPos.y} ${endPos.z}`, 
                dur: 800, 
                easing: 'easeOutQuad' 
            });

            setTimeout(() => {
                const buckets = ['basket-sap', 'basket-not-sap'];
                let hitResult = null;

                buckets.forEach(id => {
                    const bucket = document.getElementById(id);
                    const bPos = bucket.object3D.position;
                    const dist = Math.sqrt(Math.pow(endPos.x - bPos.x, 2) + Math.pow(endPos.z - bPos.z, 2));

                    if (dist < 1.0) {
                        hitResult = (id === itemBeingThrown.target);
                        if (hitResult) {
                            score += 10;
                            wiggleBucket(bucket, true);
                        } else {
                            score -= 5;
                            wiggleBucket(bucket, false);
                        }
                        document.getElementById('score-val').innerText = score;
                    }
                });
                if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
            }, 850);
        }

        function wiggleBucket(entity, isCorrect) {
            // Screen Flash
            flashOverlay.style.backgroundColor = isCorrect ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
            flashOverlay.style.opacity = '1';
            setTimeout(() => { flashOverlay.style.opacity = '0'; }, 150);

            // Bucket Animation
            entity.setAttribute('animation__wiggle', {
                property: 'rotation', to: '0 0 10', dur: 100, dir: 'alternate', loop: 4, easing: 'easeInOutQuad'
            });
            const cylinder = entity.querySelector('a-cylinder');
            const originalColor = cylinder.getAttribute('color');
            cylinder.setAttribute('color', isCorrect ? '#2ecc71' : '#ff3333');
            
            setTimeout(() => {
                cylinder.setAttribute('color', originalColor);
                entity.setAttribute('rotation', '0 0 0');
                entity.removeAttribute('animation__wiggle');
            }, 400);
        }
    </script>
</body>
</html> -->






<!-- latest -->
<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SAP Astrology: Fast Tap AR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        canvas.a-canvas { touch-action: none !important; }
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; color: white; text-align: center; padding: 20px;
        }

        .btn-start {
            padding: 20px 40px; font-size: 24px; border-radius: 12px;
            border: none; background: #e67e22; color: white; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px #d35400; transition: all 0.2s;
        }

        .btn-start:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }

        .ui-panel { position: fixed; z-index: 1001; pointer-events: none; text-shadow: 2px 2px 4px #000; }

        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; pointer-events: none; opacity: 0;
            transition: opacity 0.1s ease-in-out;
        }

        /* Swipe Animation */
        #swipe-indicator {
            position: fixed;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.8);
            pointer-events: none;
            z-index: 2000;
            transform: translate(-50%, -50%);
            opacity: 0;
        }

        .swoosh {
            animation: swoosh-animation 0.4s ease-out forwards;
        }

        @keyframes swoosh-animation {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        a-scene {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>

<body>

    <div id="flash-overlay"></div>
    <div id="swipe-indicator"></div>

    <div id="overlay">
        <h1 style="color: #67e8f9; margin-bottom: 5px; letter-spacing: 2px;">SAP FAST TAP</h1>
        <p style="margin-bottom: 25px; opacity: 0.8; line-height: 1.5;">
            <b>Mission: Rapid Identification</b><br>
            Sort SAP Terms into the BLUE bucket.<br>
            Sort Dummy Terms into the RED bucket.
        </p>
        <button class="btn-start" onclick="start()">START CHALLENGE</button>
        <p style="margin-top: 20px; font-size: 13px; color: #aaa;">Point forward & flick up to toss!</p>
    </div>

    <div class="ui-panel" style="top: 20px; left: 20px;">
        <div style="color: #2ecc71; font-size: 12px; font-weight: bold; letter-spacing: 1px;">SCORE</div>
        <div id="score-val" style="color: white; font-size: 32px; font-weight: bold;">0</div>
    </div>

    <div class="ui-panel" style="top: 20px; left: 50%; transform: translateX(-50%); text-align: center;">
        <div style="color: #67e8f9; font-size: 10px; font-weight: bold; letter-spacing: 2px;">HOLDING</div>
        <div id="current-label-ui" style="color: white; font-size: 28px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 8px 25px; border-radius: 20px; border: 1px solid rgba(103, 232, 249, 0.3); min-width: 120px;">---</div>
    </div>

    <div class="ui-panel" style="top: 20px; right: 20px; text-align: right;">
        <div style="color: #e67e22; font-size: 12px; font-weight: bold; letter-spacing: 1px;">TIME</div>
        <div id="time-val" style="color: white; font-size: 32px; font-weight: bold;">15</div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;" vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true" ar-resizer>
        
        <a-entity id="world-root">
            <a-entity id="basket-sap" position="-1.8 -1.5 -7">
                <a-cylinder color="#3498db" height="1.2" radius="0.75" open-ended="true" side="double"></a-cylinder>
                <a-text value="SAP TERM" align="center" position="0 1.5 0" scale="2.5 2.5 2.5" color="#3498db" bold="true"></a-text>
                <a-ring color="black" radius-inner="0.6" radius-outer="0.9" rotation="-90 0 0" position="0 -0.59 0" opacity="0.3"></a-ring>
            </a-entity>

            <a-entity id="basket-not-sap" position="1.8 -1.5 -7">
                <a-cylinder color="#e74c3c" height="1.2" radius="0.75" open-ended="true" side="double"></a-cylinder>
                <a-text value="NOT SAP" align="center" position="0 1.5 0" scale="2.5 2.5 2.5" color="#e74c3c" bold="true"></a-text>
                <a-ring color="black" radius-inner="0.6" radius-outer="0.9" rotation="-90 0 0" position="0 -0.59 0" opacity="0.3"></a-ring>
            </a-entity>
        </a-entity>

        <a-entity id="camera-rig" position="0 1.6 0">
            <a-camera id="mainCam" look-controls="enabled: true; touchEnabled: false; magicWindowTrackingEnabled: true" wasd-controls-enabled="false">
                <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015" material="color: #FFF; shader: flat"></a-entity>
            </a-camera>
        </a-entity>
    </a-scene>

    <script>
          AFRAME.registerComponent('ar-resizer', {
            init: function () {
                this.el.sceneEl.addEventListener('arjs-video-loaded', () => {
                    if (this.el.sceneEl.systems.renderer.arToolkitContext.arController) {
                        this.el.sceneEl.systems.renderer.arToolkitContext.arController.orientation = 'portrait';
                        this.el.sceneEl.systems.renderer.arToolkitContext.arController.apply_ar_orientation();
                    }
                    this.el.sceneEl.resize();
                });
                window.addEventListener('resize', () => {
                    this.el.sceneEl.resize();
                });
            }
        });
        // --- DATA CONFIGURATION ---
        const config = {
            timerSeconds: 30,
            winThreshold: 70,
            sapTerms: ["BAPI", "ABAP", "HANA", "FIORI", "OData", "Module", "Basis", "Cloud", "ERP", "NetWeaver", "CRM", "Ariba", "S/4HANA", "UI5", "FioriLaunchpad"],
            dummyTerms: ["Pizza", "Moon", "Forest", "Cloud-9", "C#", "Java", "React", "Swift", "Banana", "Football", "Sandwich", "Bicycle", "Guitar", "Mountain", "River"]
        };

        const gameItems = [
            ...config.sapTerms.map(t => ({ label: t, target: "basket-sap" })),
            ...config.dummyTerms.map(t => ({ label: t, target: "basket-not-sap" }))
        ];

        let score = 0;
        let timeLeft = config.timerSeconds;
        let canThrow = false;
        let gameActive = false;
        let currentItem = null;
        let timerInterval;

        const scene = document.querySelector('a-scene');
        const cam = document.querySelector('#mainCam');
        const flashOverlay = document.getElementById('flash-overlay');
        const swipeIndicator = document.getElementById('swipe-indicator');

        function prepareNextItem() {
            currentItem = gameItems[Math.floor(Math.random() * gameItems.length)];
            document.getElementById('current-label-ui').innerText = currentItem.label.toUpperCase();
        }

        function start() {
            document.getElementById('overlay').style.display = 'none';
            score = 0;
            timeLeft = config.timerSeconds;
            gameActive = true;
            canThrow = true;
            document.getElementById('score-val').innerText = "0";
            document.getElementById('time-val').innerText = timeLeft;
            document.getElementById('time-val').style.color = "white";
            prepareNextItem();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('time-val');
                timerEl.innerText = timeLeft;
                if (timeLeft <= 5) timerEl.style.color = "#ff3333";
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function endGame() {
            clearInterval(timerInterval);
            gameActive = false;
            canThrow = false;

            const didWin = score >= config.winThreshold;

            if (window.opener) {
                window.opener.postMessage({
                    type: "AR_GAME_RESULT",
                    win: didWin,
                    metadata: {
                        score: score,
                        minScoreToWin: config.winThreshold,
                        timePlayed: config.timerSeconds,
                        gameName: "SAP Fast Tap"
                    }
                }, "*");
            }

            alert(didWin ? "MISSION COMPLETE! Threshold Reached." : "TIME'S UP! Score: " + score);
            window.close();
        }

        // --- INTERACTION LOGIC ---
        let startX, startY;
        window.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        window.addEventListener('touchend', (e) => {
            if (!canThrow || !gameActive) return;
            let diffX = e.changedTouches[0].clientX - startX;
            let diffY = startY - e.changedTouches[0].clientY;

            if (diffY > 60) {
                canThrow = false;

                // --- SWIPE ANIMATION ---
                swipeIndicator.style.left = `${startX}px`;
                swipeIndicator.style.top = `${startY}px`;
                swipeIndicator.classList.add('swoosh');
                setTimeout(() => swipeIndicator.classList.remove('swoosh'), 400);

                throwBall(diffX / window.innerWidth);
                setTimeout(() => { if (gameActive) canThrow = true; }, 400); 
            }
        });

        function throwBall(tilt) {
    const itemBeingThrown = currentItem;
    const wrapper = document.createElement('a-entity');
    const ball = document.createElement('a-sphere');

    ball.setAttribute('radius', '0.15');
    ball.setAttribute('color', 'white');
    ball.setAttribute('material', 'emissive: #ffffff; emissiveIntensity: 0.3');
    
    wrapper.appendChild(ball);
    scene.appendChild(wrapper);

    prepareNextItem();

    const startPos = new THREE.Vector3();
    cam.object3D.getWorldPosition(startPos);
    const direction = new THREE.Vector3(0, 0, -1);
    direction.applyQuaternion(cam.object3D.quaternion);

    const sideVector = new THREE.Vector3(1, 0, 0);
    sideVector.applyQuaternion(cam.object3D.quaternion);
    
    direction.addScaledVector(sideVector, tilt * 3); 

    // --- LOWER THROW POINT ---
    // Initial spawn slightly in front and further below eye-level
    wrapper.setAttribute('position', {
        x: startPos.x + direction.x * 0.5,
        y: startPos.y - 0.6, // Lowered from 0.2 to 0.6
        z: startPos.z + direction.z * 0.5
    });

    const travelDistance = 8;
    const endPos = {
        x: startPos.x + direction.x * travelDistance,
        y: -1.5, // Floor level
        z: startPos.z + direction.z * travelDistance
    };

    // 1. FORWARD MOVEMENT (Wrapper)
    wrapper.setAttribute('animation', {
        property: 'position',
        to: `${endPos.x} ${endPos.y} ${endPos.z}`,
        dur: 1100,
        easing: 'linear'
    });

    // 2. THE TOSS ARC (Ball inside Wrapper)
    // Rise up
    ball.setAttribute('animation__up', {
        property: 'position',
        from: '0 0 0',
        to: '0 1.5 0', // Height of the toss
        dur: 450,
        easing: 'easeOutQuad'
    });

    // Fall down
    setTimeout(() => {
        ball.setAttribute('animation__down', {
            property: 'position',
            to: '0 0 0',
            dur: 650,
            easing: 'easeInQuad'
        });
    }, 450);

    // 3. COLLISION CHECK (Wait for the fall to complete)
    setTimeout(() => {
        const buckets = ['basket-sap', 'basket-not-sap'];
        buckets.forEach(id => {
            const bucket = document.getElementById(id);
            const bPos = bucket.object3D.position;
            
            const dist = Math.sqrt(
                Math.pow(endPos.x - bPos.x, 2) + 
                Math.pow(endPos.z - bPos.z, 2)
            );

            if (dist < 0.85) { 
                if (id === itemBeingThrown.target) {
                    score += 10;
                    wiggleBucket(bucket, true);
                } else {
                    score -= 5;
                    wiggleBucket(bucket, false);
                }
                document.getElementById('score-val').innerText = score;
            }
        });

        if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
    }, 1150);
}

        function wiggleBucket(entity, isCorrect) {
            // Screen Flash
            flashOverlay.style.backgroundColor = isCorrect ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
            flashOverlay.style.opacity = '1';
            setTimeout(() => { flashOverlay.style.opacity = '0'; }, 150);

            // Bucket Animation
            entity.setAttribute('animation__wiggle', {
                property: 'rotation', to: '0 0 10', dur: 100, dir: 'alternate', loop: 4, easing: 'easeInOutQuad'
            });
            const cylinder = entity.querySelector('a-cylinder');
            const originalColor = cylinder.getAttribute('color');
            cylinder.setAttribute('color', isCorrect ? '#2ecc71' : '#ff3333');
            
            setTimeout(() => {
                cylinder.setAttribute('color', originalColor);
                entity.setAttribute('rotation', '0 0 0');
                entity.removeAttribute('animation__wiggle');
            }, 400);
        }
    </script>
</body>
</html> -->




<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SAP Astrology: Fast Tap AR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        canvas.a-canvas { touch-action: none !important; }
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; color: white; text-align: center; padding: 20px;
        }

        .btn-start {
            padding: 20px 40px; font-size: 24px; border-radius: 12px;
            border: none; background: #e67e22; color: white; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px #d35400; transition: all 0.2s;
        }

        .btn-start:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }

        .ui-panel { position: fixed; z-index: 1001; pointer-events: none; text-shadow: 2px 2px 4px #000; }

        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; pointer-events: none; opacity: 0;
            transition: opacity 0.1s ease-in-out;
        }

        #instruction-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2000; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; justify-content: center;
            align-items: center; color: white; text-align: center; padding: 20px;
        }

        #swipe-animation {
            width: 100px;
            height: 150px;
            position: relative;
            margin-bottom: 20px;
        }

        #swipe-animation .finger {
            width: 30px;
            height: 30px;
            background: #e67e22;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            animation: swipe-up 1.5s ease-in-out infinite;
        }

        @keyframes swipe-up {
            0% {
                bottom: 0;
                opacity: 1;
            }
            100% {
                bottom: 100px;
                opacity: 0;
            }
        }

        .swoosh {
            animation: swoosh-animation 0.4s ease-out forwards;
        }

        @keyframes swoosh-animation {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        a-scene {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>

<body>

    <div id="flash-overlay"></div>
    <div id="swipe-indicator"></div>

    <div id="instruction-overlay">
        <div id="swipe-animation">
            <div class="finger"></div>
        </div>
        <p>Swipe up to throw the ball!</p>
        <button class="btn-start" onclick="startGame()">GOT IT!</button>
    </div>

    <div id="overlay">
        <h1 style="color: #67e8f9; margin-bottom: 5px; letter-spacing: 2px;">SAP FAST TAP</h1>
        <p style="margin-bottom: 25px; opacity: 0.8; line-height: 1.5;">
            <b>Mission: Rapid Identification</b><br>
            Sort SAP Terms into the BLUE bucket.<br>
            Sort Dummy Terms into the RED bucket.
        </p>
        <button class="btn-start" onclick="showInstructions()">START CHALLENGE</button>
        <p style="margin-top: 20px; font-size: 13px; color: #aaa;">Point forward & flick up to toss!</p>
    </div>

    <div class="ui-panel" style="top: 20px; left: 20px;">
        <div style="color: #2ecc71; font-size: 12px; font-weight: bold; letter-spacing: 1px;">SCORE</div>
        <div id="score-val" style="color: white; font-size: 32px; font-weight: bold;">0</div>
    </div>

    <div class="ui-panel" style="top: 20px; left: 50%; transform: translateX(-50%); text-align: center;">
        <div style="color: #67e8f9; font-size: 10px; font-weight: bold; letter-spacing: 2px;">HOLDING</div>
        <div id="current-label-ui" style="color: white; font-size: 28px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 8px 25px; border-radius: 20px; border: 1px solid rgba(103, 232, 249, 0.3); min-width: 120px;">---</div>
    </div>

    <div class="ui-panel" style="top: 20px; right: 20px; text-align: right;">
        <div style="color: #e67e22; font-size: 12px; font-weight: bold; letter-spacing: 1px;">TIME</div>
        <div id="time-val" style="color: white; font-size: 32px; font-weight: bold;">15</div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;" vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true" ar-resizer ar-hit-test-enable>
        
        <a-entity id="world-root">
            <a-entity id="basket-sap" position="-1.8 -1.5 -7">
                <a-cylinder color="#3498db" height="1.2" radius="0.75" open-ended="true" side="double"></a-cylinder>
                <a-text value="SAP TERM" align="center" position="0 1.5 0" scale="2.5 2.5 2.5" color="#3498db" bold="true"></a-text>
                <a-ring color="black" radius-inner="0.6" radius-outer="0.9" rotation="-90 0 0" position="0 -0.59 0" opacity="0.3"></a-ring>
            </a-entity>

            <a-entity id="basket-not-sap" position="1.8 -1.5 -7">
                <a-cylinder color="#e74c3c" height="1.2" radius="0.75" open-ended="true" side="double"></a-cylinder>
                <a-text value="NOT SAP" align="center" position="0 1.5 0" scale="2.5 2.5 2.5" color="#e74c3c" bold="true"></a-text>
                <a-ring color="black" radius-inner="0.6" radius-outer="0.9" rotation="-90 0 0" position="0 -0.59 0" opacity="0.3"></a-ring>
            </a-entity>
        </a-entity>

        <a-entity id="camera-rig" position="0 1.6 0">
            <a-camera id="mainCam" look-controls="enabled: true; touchEnabled: false; magicWindowTrackingEnabled: true" wasd-controls-enabled="false">
                <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015" material="color: #FFF; shader: flat"></a-entity>
            </a-camera>
        </a-entity>
    </a-scene>

    <script>
        AFRAME.registerComponent('ar-resizer', {
            init: function () {
                const sceneEl = this.el.sceneEl;

                const forceResize = () => {
                    const arController = sceneEl.systems.renderer?.arToolkitContext?.arController;
                    if (!arController) return;
                    
                    arController.orientation = 'portrait';
                    arController.apply_ar_orientation();
                    
                    // Force A-Frame to resize the canvas
                    sceneEl.resize();
                };

                sceneEl.addEventListener('arjs-video-loaded', () => {
                    forceResize();
                    // Call it again after a delay to handle any late adjustments
                    setTimeout(forceResize, 500);
                });

                window.addEventListener('resize', forceResize);
            }
        });

        // --- DATA CONFIGURATION ---
        const config = {
            timerSeconds: 30,
            winThreshold: 0,
            sapTerms: ["BAPI", "ABAP", "HANA", "FIORI", "OData", "Module", "Basis", "Cloud", "ERP", "NetWeaver", "CRM", "Ariba", "S/4HANA", "UI5", "FioriLaunchpad"],
            dummyTerms: ["Pizza", "Moon", "Forest", "Cloud-9", "C#", "Java", "React", "Swift", "Banana", "Football", "Sandwich", "Bicycle", "Guitar", "Mountain", "River"]
        };

        const gameItems = [
            ...config.sapTerms.map(t => ({ label: t, target: "basket-sap" })),
            ...config.dummyTerms.map(t => ({ label: t, target: "basket-not-sap" }))
        ];

        let score = 0;
        let timeLeft = config.timerSeconds;
        let canThrow = false;
        let gameActive = false;
        let currentItem = null;
        let timerInterval;

        const scene = document.querySelector('a-scene');
        const cam = document.querySelector('#mainCam');
        const flashOverlay = document.getElementById('flash-overlay');
        const swipeIndicator = document.getElementById('swipe-indicator');

        function prepareNextItem() {
            currentItem = gameItems[Math.floor(Math.random() * gameItems.length)];
            document.getElementById('current-label-ui').innerText = currentItem.label.toUpperCase();
        }

        function showInstructions() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('instruction-overlay').style.display = 'flex';
        }

        function startGame() {
            document.getElementById('instruction-overlay').style.display = 'none';
            score = 0;
            timeLeft = config.timerSeconds;
            gameActive = true;
            canThrow = true;
            document.getElementById('score-val').innerText = "0";
            document.getElementById('time-val').innerText = timeLeft;
            document.getElementById('time-val').style.color = "white";
            prepareNextItem();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('time-val');
                timerEl.innerText = timeLeft;
                if (timeLeft <= 5) timerEl.style.color = "#ff3333";
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function endGame() {
            clearInterval(timerInterval);
            gameActive = false;
            canThrow = false;

            const didWin = score >= config.winThreshold;

            if (window.opener) {
                window.opener.postMessage({
                    type: "AR_GAME_RESULT",
                    win: didWin,
                    metadata: {
                        score: score,
                        minScoreToWin: config.winThreshold,
                        timePlayed: config.timerSeconds,
                        gameName: "SAP Fast Tap"
                    }
                }, "*");
            }

            // Give the message a moment to send before closing the window
            setTimeout(() => {
                window.close();
            }, 100);
        }

        // --- INTERACTION LOGIC ---
        let startX, startY;
        window.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        window.addEventListener('touchend', (e) => {
            if (!canThrow || !gameActive) return;
            let diffX = e.changedTouches[0].clientX - startX;
            let diffY = startY - e.changedTouches[0].clientY;

            if (diffY > 60) {
                canThrow = false;

                // --- SWIPE ANIMATION ---
                swipeIndicator.style.left = `${startX}px`;
                swipeIndicator.style.top = `${startY}px`;
                swipeIndicator.classList.add('swoosh');
                setTimeout(() => swipeIndicator.classList.remove('swoosh'), 400);

                throwBall(diffX / window.innerWidth);
                setTimeout(() => { if (gameActive) canThrow = true; }, 400); 
            }
        });

        function throwBall(tilt) {
    const itemBeingThrown = currentItem;
    const wrapper = document.createElement('a-entity');
    const ball = document.createElement('a-sphere');

    ball.setAttribute('radius', '0.15');
    ball.setAttribute('color', 'white');
    ball.setAttribute('material', 'emissive: #ffffff; emissiveIntensity: 0.3');
    
    wrapper.appendChild(ball);
    scene.appendChild(wrapper);

    prepareNextItem();

    const startPos = new THREE.Vector3();
    cam.object3D.getWorldPosition(startPos);
    const direction = new THREE.Vector3(0, 0, -1);
    direction.applyQuaternion(cam.object3D.quaternion);

    const sideVector = new THREE.Vector3(1, 0, 0);
    sideVector.applyQuaternion(cam.object3D.quaternion);
    
    direction.addScaledVector(sideVector, tilt * 3); 

    // --- LOWER THROW POINT ---
    // Initial spawn slightly in front and further below eye-level
    wrapper.setAttribute('position', {
        x: startPos.x + direction.x * 0.5,
        y: startPos.y - 0.6, // Lowered from 0.2 to 0.6
        z: startPos.z + direction.z * 0.5
    });

    const travelDistance = 8;
    const endPos = {
        x: startPos.x + direction.x * travelDistance,
        y: -1.5, // Floor level
        z: startPos.z + direction.z * travelDistance
    };

    // 1. FORWARD MOVEMENT (Wrapper)
    wrapper.setAttribute('animation', {
        property: 'position',
        to: `${endPos.x} ${endPos.y} ${endPos.z}`,
        dur: 1100,
        easing: 'linear'
    });

    // 2. THE TOSS ARC (Ball inside Wrapper)
    // Rise up
    ball.setAttribute('animation__up', {
        property: 'position',
        from: '0 0 0',
        to: '0 1.5 0', // Height of the toss
        dur: 450,
        easing: 'easeOutQuad'
    });

    // Fall down
    setTimeout(() => {
        ball.setAttribute('animation__down', {
            property: 'position',
            to: '0 0 0',
            dur: 650,
            easing: 'easeInQuad'
        });
    }, 450);

    // 3. COLLISION CHECK (Wait for the fall to complete)
    setTimeout(() => {
        const buckets = ['basket-sap', 'basket-not-sap'];
        buckets.forEach(id => {
            const bucket = document.getElementById(id);
            const bPos = bucket.object3D.position;
            
            const dist = Math.sqrt(
                Math.pow(endPos.x - bPos.x, 2) + 
                Math.pow(endPos.z - bPos.z, 2)
            );

            if (dist < 0.85) { 
                if (id === itemBeingThrown.target) {
                    score += 10;
                    wiggleBucket(bucket, true);
                } else {
                    score -= 5;
                    wiggleBucket(bucket, false);
                }
                document.getElementById('score-val').innerText = score;
            }
        });

        if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
    }, 1150);
}

        function wiggleBucket(entity, isCorrect) {
            // Screen Flash
            flashOverlay.style.backgroundColor = isCorrect ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
            flashOverlay.style.opacity = '1';
            setTimeout(() => { flashOverlay.style.opacity = '0'; }, 150);

            // Bucket Animation
            entity.setAttribute('animation__wiggle', {
                property: 'rotation', to: '0 0 10', dur: 100, dir: 'alternate', loop: 4, easing: 'easeInOutQuad'
            });
            const cylinder = entity.querySelector('a-cylinder');
            const originalColor = cylinder.getAttribute('color');
            cylinder.setAttribute('color', isCorrect ? '#2ecc71' : '#ff3333');
            
            setTimeout(() => {
                cylinder.setAttribute('color', originalColor);
                entity.setAttribute('rotation', '0 0 0');
                entity.removeAttribute('animation__wiggle');
            }, 400);
        }
    </script>
</body>
</html>
